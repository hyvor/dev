## HYVOR MAIN

This is the starting point to start developing HYVOR products. It contains the other repositories as submodules.

Components:

- `core` (hyvor.com)
- `talk` (talk.hyvor.com)
- `blogs` (blogs.hyvor.com)

Other:

- `internal` - Internal PHP library

## First Time Setup

### Pre-requisites

- [Git](https://git-scm.com/downloads)
- [Docker](https://docs.docker.com/engine/install/)
- [mkcert](https://github.com/FiloSottile/mkcert)

### Clone the Repository

Create a new directory for HYVOR development, if you don't have one already:

```bash
mkdir hyvor/main
cd hyvor/main
```

All below commands are to be run in this directory.

Clone this repository:

```bash
git clone --recurse-submodules https://github.com/hyvor/dev .
```

### Init

Run the following command to initialize the project. You only need to run this once.

```bash
./init
```

This command:

- Generates SSL certificates for the development server using `mkcert`.
- Creates the docker network `hyvor-network`.
- Creates data directories for databases for Minio (S3).

Even in the local development, we use a domain name with HTTPS to mimic the production environment. To resolve *.hyvor.dev to 127.0.0.1, add the following lines to your `/etc/hosts` file:

```bash
127.0.0.1 hyvor.dev
127.0.0.1 talk.hyvor.dev
127.0.0.1 blogs.hyvor.dev
```

(as more products are added, you will need to add them to the `/etc/hosts` file)

### Run

Once init is done, you can run services and components.

To run all services, run:

```bash
docker compose up -d
```

It starts the following services:

| Service             | URL                                                  | Username, Password |
|---------------------| ---------------------------------------------------- |--------------------|
| Traefik             | (Proxy for `*.hyvor.dev`)                              |                    | 
| Postgres | `postgres://hyvor-service-postgres:5432`         | postgres, postgres |
| Mailpit             | [http://mailpit.localhost](http://mailpit.localhost) |
| Minio               | [http://minio.localhost](http://minio.localhost)     | minio, miniopwd    |
| WhoDB               | [http://whodb.localhost](http://whodb.localhost)     |                    |


To run a specific component, run:

```bash
./run core
```

If you want to run another service, you can run it like this in a new terminal:

```bash
./run talk
```

Then visit the component URL in your browser:

- [https://hyvor.dev](https://hyvor.dev)
- [https://talk.hyvor.dev](https://talk.hyvor.dev)
- [https://blogs.hyvor.dev](https://blogs.hyvor.dev)

### Stop

To stop all services, run:

```bash
docker compose down
```

To stop a specific component, run `CTRL+C` in the terminal where you ran the `./run` command.

### How it works

- Development
  - Each component has a Dockerfile that builds the development environment with all the required dependencies.
  - They also have a `compose.yaml` file that configures `composer watch` to automatically sync your code changes to the container.
  - Everything runs in Docker containers, so you don't need to install anything on your local machine.
- hyvor.dev and localhost services
  - Traefik listens to port 80 and 443 on your local machine.
  - It routes requests to the correct service based on Docker labels using auto discovery.
  - It uses the SSL certificates generated by `mkcert` to serve HTTPS.
  - `mkcert` (usually) configures your OS and browser to trust the mkcert root certificate, so you don't see SSL warnings. A browser restart may be required.